import"./modulepreload-polyfill-B5Qt9EMX.js";const x=()=>{const e=new Set;return{subscribe:a=>e.add(a),notify:()=>e.forEach(a=>a())}},g=e=>{const{subscribe:t,notify:n}=x();let a={...e};return{getState:()=>({...a}),setState:c=>{a={...a,...c},n()},subscribe:t}},d=g({products:[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],cartProducts:[],totalQuantity:0,totalAmountBeforeDiscount:0,totalAmount:0,cartProductsCount:0,bonusPoints:0,lastSelectedProductId:null,discountRate:0}),b=30,m={tuesday:.1,bulk:.25},S=()=>new Date().getDay()===2,C=(e,t,n)=>S()?I(t):e<b?P(t,n):q(t,n),I=e=>({discountRate:m.tuesday,discountedPrice:e}),P=(e,t)=>({discountRate:(t-e)/t,discountedPrice:e}),q=(e,t)=>{const n=e*m.bulk,a=t-e,o=n>a?e*(1-m.bulk):a-a;return{discountRate:m.bulk,discountedPrice:o}},E=e=>{const t=e[Math.floor(Math.random()*e.length)];if(Math.random()<.3&&t.quantity>0){const n=Math.round(t.price*.8),a=e.map(o=>o.id===t.id?{...o,price:n}:o);return alert(`번개세일! ${t.name}이(가) 20% 할인 중입니다!`),a}},T=(e,t)=>{if(!t)return;const n=e.find(o=>o.id!==t&&o.quantity>0);return n?(alert(`${n.name}은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!`),n.price=Math.round(n.price*.95),e.map(o=>o.id===n.id?{...o,price:Math.round(n.price*.95)}:o)):void 0},v=Object.freeze({p1:.1,p2:.15,p3:.2,p4:.05,p5:.25}),B=()=>{const e=document.getElementById("app"),t=document.createElement("div");t.className="bg-gray-100 p-8";const n=document.createElement("div");n.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8";const a=document.createElement("h1");a.className="text-2xl font-bold mb-4",a.textContent="장바구니";const o=document.createElement("div");o.id="cart-items";const s=document.createElement("div");s.id="cart-total",s.className="text-xl font-bold my-4";const c=document.createElement("select");c.id="product-select",c.className="border rounded p-2 mr-2";const r=document.createElement("button");r.id="add-to-cart",r.className="bg-blue-500 text-white px-4 py-2 rounded",r.textContent="추가";const i=document.createElement("div");i.id="stock-status",i.className="text-sm text-gray-500 mt-2",n.appendChild(a),n.appendChild(o),n.appendChild(s),n.appendChild(c),n.appendChild(r),n.appendChild(i),t.appendChild(n),e.appendChild(t),setTimeout(()=>{setInterval(()=>{const{products:u}=d.getState(),l=E(u);l&&(d.setState({products:l}),y())},3e4)},Math.random()*1e4),setTimeout(()=>{setInterval(()=>{const{products:u,lastSelectedProductId:l}=d.getState(),f=T(u,l);f&&(d.setState({products:f}),y())},3e4)},Math.random()*1e4),d.subscribe(h),h(),y()},p=e=>{let t=0,n=0,a=0;e.forEach(r=>{const i=r.quantity,u=r.price*i;if(t+=i,n+=u,i<10){a+=u;return}a+=u*(1-v[r.id])});const{discountRate:o,discountedPrice:s}=C(t,a,n),c=Math.floor(s/1e3);return{totalQuantity:t,totalAmountBeforeDiscount:n,totalAmount:s,discountRate:o,bonusPoints:c}},h=()=>{const{cartProducts:e,totalAmount:t,bonusPoints:n,discountRate:a}=d.getState();$(e),w(t),L(n),k(a),D()},$=e=>{const t=document.getElementById("cart-items"),n=Array.from(t.children),a=n.filter(o=>!e.some(s=>s.id===o.id));for(const o of a)t.removeChild(o);for(const o of e){const s=n.findIndex(c=>c.id===o.id);if(s===-1){t.appendChild(j(o));return}n[s].querySelector("span").textContent=`${o.name} - ${o.price}원 x ${o.quantity}`}},y=()=>{const{products:e}=d.getState(),t=document.getElementById("product-select");t.innerHTML="",e.forEach(n=>{const a=H(n);t.appendChild(a)})},w=e=>{const t=document.getElementById("cart-total");t.textContent=`총액: ${Math.round(e)}원`},k=e=>{const t=document.getElementById("cart-total");if(e>0){const n=document.createElement("span");n.classList.add("text-green-500","ml-2"),n.textContent=`(${(e*100).toFixed(1)}% 할인 적용)`,t.appendChild(n)}},L=e=>{let t=document.getElementById("loyalty-points");if(!t){const n=document.getElementById("cart-total");t=document.createElement("span"),t.id="loyalty-points",t.className="text-blue-500 ml-2",n.appendChild(t)}t.textContent=`(포인트: ${e})`},D=()=>{const{products:e}=d.getState();let t="";e.forEach(a=>t+=F(a));const n=document.getElementById("stock-status");n.textContent=t};B();const R=e=>{const{cartProducts:t}=d.getState();return t.some(n=>n.id===e)},A=e=>{const{products:t,cartProducts:n}=d.getState(),a=p(n.filter(o=>o.id!==e.id));d.setState({products:t.map(o=>o.id===e.id?{...o,quantity:o.quantity+e.quantity}:o),cartProducts:n.filter(o=>o.id!==e.id),...a})},M=(e,t)=>{const{products:n,cartProducts:a}=d.getState(),o=n.find(c=>c.id===e.id);if(!o||t>0&&o.quantity<1){alert("재고가 부족합니다.");return}const s=p([...a.map(c=>c.id===e.id?{...c,quantity:c.quantity+t}:c)]);d.setState({products:n.map(c=>c.id===e.id?{...c,quantity:c.quantity+t*-1}:c),cartProducts:a.map(c=>c.id===e.id?{...c,quantity:c.quantity+t}:c),...s})},N=()=>{const{products:e,cartProducts:t}=d.getState(),a=document.getElementById("product-select").value,o=e.find(c=>c.id===a);if(!o||o.quantity<=0){alert("재고가 부족합니다.");return}if(o.quantity>0&&!R(a)){const c=p([...t,{...o,quantity:1}]);d.setState({products:e.map(r=>r.id===a?{...r,quantity:r.quantity-1}:r),cartProducts:[...t,{...o,quantity:1}],lastSelectedProductId:a,...c});return}const s=p([...t.map(c=>c.id===a?{...c,quantity:c.quantity+1}:c)]);d.setState({products:e.map(c=>c.id===a?{...c,quantity:c.quantity-1}:c),cartProducts:t.map(c=>c.id===a?{...c,quantity:c.quantity+1}:c),lastSelectedProduct:a,...s})},O=e=>{const{cartProducts:t}=d.getState();var n=e.target;if(n.classList.contains("quantity-change")||n.classList.contains("remove-item")){var a=n.dataset.productId,o=t.find(c=>c.id===a);if(n.classList.contains("quantity-change")){var s=parseInt(n.dataset.change);M(o,s)}else n.classList.contains("remove-item")&&A(o)}},_=document.getElementById("add-to-cart");_.addEventListener("click",N);const U=document.getElementById("cart-items");U.addEventListener("click",O);function H({id:e,name:t,price:n,quantity:a}){const o=document.createElement("option");return o.value=e,o.textContent=`${t} - ${n}원`,a===0&&(o.disabled=!0),o}function F({name:e,quantity:t}){return t>=5?"":t>0?`${e}: 재고 부족 (${t}개 남음) `:`${e}: 품절 `}function j({id:e,name:t,price:n,quantity:a}){const o=document.createElement("div");return o.id=e,o.className="flex justify-between items-center mb-2",o.innerHTML=`
    <span>${t} - ${n}원 x ${a}</span>
    <div>
      <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${e}" data-change="-1">-</button>
      <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${e}" data-change="1">+</button>
      <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${e}">삭제</button>
    </div>
  `,o}
