import"./modulepreload-polyfill-B5Qt9EMX.js";const b=()=>{const t=new Set;return{subscribe:a=>t.add(a),notify:()=>t.forEach(a=>a())}},S=t=>{const{subscribe:e,notify:n}=b();let a={...t};return{getState:()=>({...a}),setState:c=>{a={...a,...c},n()},subscribe:e}},r=S({products:[{id:"p1",name:"상품1",price:1e4,quantity:50},{id:"p2",name:"상품2",price:2e4,quantity:30},{id:"p3",name:"상품3",price:3e4,quantity:20},{id:"p4",name:"상품4",price:15e3,quantity:0},{id:"p5",name:"상품5",price:25e3,quantity:10}],cartProducts:[],totalQuantity:0,totalAmountBeforeDiscount:0,totalAmount:0,cartProductsCount:0,bonusPoints:0,lastSelectedProductId:null,discountRate:0}),I=30,y={tuesday:.1,bulk:.25},q=t=>{switch(t){case"p1":return .1;case"p2":return .15;case"p3":return .2;case"p4":return .05;case"p5":return .25}},C=()=>new Date().getDay()===2,E=(t,e,n)=>C()?P(e):t<I?v(e,n):T(e,n),P=t=>({discountRate:y.tuesday,discountedPrice:t}),v=(t,e)=>({discountRate:(e-t)/e,discountedPrice:t}),T=(t,e)=>{const n=t*y.bulk,a=e-t,o=n>a?t*(1-y.bulk):a-a;return{discountRate:y.bulk,discountedPrice:o}},B=()=>{const t=document.getElementById("app"),e=document.createElement("div");e.className="bg-gray-100 p-8";const n=document.createElement("div");n.className="max-w-md mx-auto bg-white rounded-xl shadow-md overflow-hidden md:max-w-2xl p-8";const a=document.createElement("h1");a.className="text-2xl font-bold mb-4",a.textContent="장바구니";const o=document.createElement("div");o.id="cart-items";const s=document.createElement("div");s.id="cart-total",s.className="text-xl font-bold my-4";const c=document.createElement("select");c.id="product-select",c.className="border rounded p-2 mr-2";const d=document.createElement("button");d.id="add-to-cart",d.className="bg-blue-500 text-white px-4 py-2 rounded",d.textContent="추가";const u=document.createElement("div");u.id="stock-status",u.className="text-sm text-gray-500 mt-2",n.appendChild(a),n.appendChild(o),n.appendChild(s),n.appendChild(c),n.appendChild(d),n.appendChild(u),e.appendChild(n),t.appendChild(e),setTimeout(()=>{setInterval(()=>{const{products:i}=r.getState(),l=i[Math.floor(Math.random()*i.length)];if(Math.random()<.3&&l.quantity>0){const m=Math.round(l.price*.8),p=i.map(x=>x.id===l.id?{...x,price:m}:x);r.setState({products:p}),alert(`번개세일! ${l.name}이(가) 20% 할인 중입니다!`),h()}},3e4)},Math.random()*1e4),setTimeout(()=>{setInterval(()=>{const{products:i,lastSelectedProductId:l}=r.getState();if(!l)return;const m=i.find(p=>p.id!==l&&p.quantity>0);m&&(alert(m.name+"은(는) 어떠세요? 지금 구매하시면 5% 추가 할인!"),m.price=Math.round(m.price*.95),h())},6e4)},Math.random()*2e4),r.subscribe(g),g(),h()},f=t=>{let e=0,n=0,a=0;t.forEach(d=>{const u=d.quantity,i=d.price*u;if(e+=u,n+=i,u<10){a+=i;return}a+=i*(1-q(d.id))});const{discountRate:o,discountedPrice:s}=E(e,a,n),c=Math.floor(s/1e3);return{totalQuantity:e,totalAmountBeforeDiscount:n,totalAmount:s,discountRate:o,bonusPoints:c}},g=()=>{const{cartProducts:t,totalAmount:e,bonusPoints:n,discountRate:a}=r.getState();$(t),w(e),L(n),k(a),D()},$=t=>{const e=document.getElementById("cart-items"),n=Array.from(e.children),a=n.filter(o=>!t.some(s=>s.id===o.id));for(const o of a)e.removeChild(o);for(const o of t){const s=n.findIndex(c=>c.id===o.id);if(s===-1){e.appendChild(Q(o));return}n[s].querySelector("span").textContent=`${o.name} - ${o.price}원 x ${o.quantity}`}},h=()=>{const{products:t}=r.getState(),e=document.getElementById("product-select");e.innerHTML="",t.forEach(n=>{const a=U(n);e.appendChild(a)})},w=t=>{const e=document.getElementById("cart-total");e.textContent=`총액: ${Math.round(t)}원`},k=t=>{const e=document.getElementById("cart-total");if(t>0){const n=document.createElement("span");n.classList.add("text-green-500","ml-2"),n.textContent=`(${(t*100).toFixed(1)}% 할인 적용)`,e.appendChild(n)}},L=t=>{let e=document.getElementById("loyalty-points");if(!e){const n=document.getElementById("cart-total");e=document.createElement("span"),e.id="loyalty-points",e.className="text-blue-500 ml-2",n.appendChild(e)}e.textContent=`(포인트: ${t})`},D=()=>{const{products:t}=r.getState();let e="";t.forEach(a=>e+=F(a));const n=document.getElementById("stock-status");n.textContent=e};B();const A=t=>{const{cartProducts:e}=r.getState();return e.some(n=>n.id===t)},M=t=>{const{products:e,cartProducts:n}=r.getState(),a=f(n.filter(o=>o.id!==t.id));r.setState({products:e.map(o=>o.id===t.id?{...o,quantity:o.quantity+t.quantity}:o),cartProducts:n.filter(o=>o.id!==t.id),...a})},N=(t,e)=>{const{products:n,cartProducts:a}=r.getState(),o=n.find(c=>c.id===t.id);if(!o||e>0&&o.quantity<1){alert("재고가 부족합니다.");return}const s=f([...a.map(c=>c.id===t.id?{...c,quantity:c.quantity+e}:c)]);r.setState({products:n.map(c=>c.id===t.id?{...c,quantity:c.quantity+e*-1}:c),cartProducts:a.map(c=>c.id===t.id?{...c,quantity:c.quantity+e}:c),...s})},R=()=>{const{products:t,cartProducts:e}=r.getState(),a=document.getElementById("product-select").value,o=t.find(c=>c.id===a);if(!o||o.quantity<=0){alert("재고가 부족합니다.");return}if(o.quantity>0&&!A(a)){const c=f([...e,{...o,quantity:1}]);r.setState({products:t.map(d=>d.id===a?{...d,quantity:d.quantity-1}:d),cartProducts:[...e,{...o,quantity:1}],lastSelectedProductId:a,...c});return}const s=f([...e.map(c=>c.id===a?{...c,quantity:c.quantity+1}:c)]);r.setState({products:t.map(c=>c.id===a?{...c,quantity:c.quantity-1}:c),cartProducts:e.map(c=>c.id===a?{...c,quantity:c.quantity+1}:c),lastSelectedProduct:a,...s})},O=t=>{const{cartProducts:e}=r.getState();var n=t.target;if(n.classList.contains("quantity-change")||n.classList.contains("remove-item")){var a=n.dataset.productId,o=e.find(c=>c.id===a);if(n.classList.contains("quantity-change")){var s=parseInt(n.dataset.change);N(o,s)}else n.classList.contains("remove-item")&&M(o)}},H=document.getElementById("add-to-cart");H.addEventListener("click",R);const _=document.getElementById("cart-items");_.addEventListener("click",O);function U({id:t,name:e,price:n,quantity:a}){const o=document.createElement("option");return o.value=t,o.textContent=`${e} - ${n}원`,a===0&&(o.disabled=!0),o}function F({name:t,quantity:e}){return e>=5?"":e>0?`${t}: 재고 부족 (${e}개 남음) `:`${t}: 품절 `}function Q({id:t,name:e,price:n,quantity:a}){const o=document.createElement("div");return o.id=t,o.className="flex justify-between items-center mb-2",o.innerHTML=`
    <span>${e} - ${n}원 x ${a}</span>
    <div>
      <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t}" data-change="-1">-</button>
      <button class="quantity-change bg-blue-500 text-white px-2 py-1 rounded mr-1" data-product-id="${t}" data-change="1">+</button>
      <button class="remove-item bg-red-500 text-white px-2 py-1 rounded" data-product-id="${t}">삭제</button>
    </div>
  `,o}
